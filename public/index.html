<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ChatLite â€“ Login</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="login-body">
  <div class="login-card">
    <h1>ChatLite</h1>
    <input id="username" placeholder="username" />
    <input id="password" type="password" placeholder="password"/>
    <div class="row">
      <button id="btn-register">Register</button>
      <button id="btn-login">Login</button>
    </div>
    <div id="login-msg" class="muted"></div>
  </div>

  <script>
    const msg = (t) => document.getElementById('login-msg').textContent = t;
    const headers = () => ({ "Content-Type":"application/json" });

    async function register(){
      const r = await fetch("/api/auth/register", {
        method:"POST", headers:headers(),
        body: JSON.stringify({ username: u().value, password: p().value })
      });
      const d = await r.json(); msg(r.ok ? "Registered. You can log in now." : (d.error || "Error"));
    }
    async function login(){
      const r = await fetch("/api/auth/login", {
        method:"POST", headers:headers(),
        body: JSON.stringify({ username: u().value, password: p().value })
      });
      const d = await r.json();
      if(!r.ok){ msg(d.error || 'Login failed'); return; }
      localStorage.setItem("token", d.token);
      localStorage.setItem("me", JSON.stringify(d.user));
      location.href = "/app.html";
    }

    const u = ()=>document.getElementById('username');
    const p = ()=>document.getElementById('password');
    document.getElementById('btn-register').onclick = register;
    document.getElementById('btn-login').onclick = login;
  </script>
</body>
</html>
